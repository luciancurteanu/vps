---
# Global variables for VPS
# This file contains all default configuration values used across playbooks.
# Override these values in host_vars files for host-specific configuration.
# For sensitive data like passwords, use Ansible Vault instead.

########################
# SYSTEM CONFIGURATION #
########################

# Timezone and locale settings
timezone: Europe/London
use_local_rtc: false
locale: en_US.UTF-8

# Firewall settings
firewall_enabled: true
firewall_service: iptables

#########################
# DOMAIN CONFIGURATION  #
#########################

# Master domain configuration
# If `--domain` is provided by the wrapper (`vps.sh`) it will be used;
# otherwise fall back to the inventory hostname so `domain == master_domain`
# will still match when running without extra-vars.
master_domain: "{{ domain | default(inventory_hostname) }}"

###################################
# ROLE VARIABLES (setup.yml order)
###################################

#########################
# 1. COMMON ROLE        #
#########################

# Admin user configuration
admin_user: admin  # Username for sudo-enabled admin account
admin_group: admin  # Primary group for admin user
admin_shell: /bin/bash  # Default shell for admin user
admin_password: "{{ vault_admin_password | default(lookup('env', 'ADMIN_PASSWORD'), true) }}"  # Admin password (from vault)
admin_ssh_public_key: "{{ vault_admin_ssh_public_key | default(omit) }}"  # SSH public key for admin (from vault)
create_admin_user: true  # Whether to create admin user during provisioning
admin_auth: password  # Authentication method: 'password' or 'key'
admin_sudo_nopasswd: true  # Allow admin to use sudo without password

# SSH configuration (common role)
ssh_port: 22  # SSH listening port
ssh_permit_root_login: "no"  # Allow root login (no = more secure)
ssh_password_authentication: "yes"  # Allow password authentication (set to 'no' after key setup)
ssh_pubkey_authentication: "yes"  # Allow public key authentication
ssh_allow_agent_forwarding: "no"  # Allow SSH agent forwarding
ssh_allow_tcp_forwarding: "no"  # Allow TCP port forwarding
ssh_x11_forwarding: "no"  # Allow X11 GUI forwarding
ssh_max_auth_tries: 3  # Maximum authentication attempts per connection
ssh_max_sessions: 10  # Maximum concurrent SSH sessions per connection
ssh_client_alive_interval: 300  # Seconds before server sends keepalive (5 min)
ssh_client_alive_count_max: 3  # Keepalive messages before disconnecting inactive client
ssh_service_name: sshd  # SSH service name for systemd management

#########################
# 2. WEBMIN ROLE        #
#########################

install_webmin: true  # Install Webmin control panel
webmin_port: 10000     # Webmin port (default is 10000)
webmin_subdomain: "cpanel.{{ domain }}" # Change to "admin" or "panel" etc
webmin_nginx_proxy: true  # Enable nginx reverse proxy
webmin_ssl_enabled: false  # SSL termination at nginx (requires SSL certificates)

#########################
# 3. COCKPIT ROLE       #
#########################

install_cockpit: false  # Disabled by default (webmin is primary control panel)
cockpit_port: 9090  # Cockpit port (default is 9090)
cockpit_subdomain: "cpanel.{{ domain }}" # Change to "admin" or "panel" etc

#########################
# 4. NGINX ROLE         #
#########################

domain_user: "{{ master_domain }}"  # User account for domain/vhost ownership

#########################
# 5. PHP ROLE           #
#########################

php_version: "8.4"  # PHP version from Remi repository
# Managed PHP-FPM pools to create during setup (list of domain names)
# Add any domains for which you want a dedicated php-fpm pool created
# Example: goapi.cloud and common subdomains
php_fpm_pools:
  - goapi.cloud
  - cpanel.goapi.cloud
  - mail.goapi.cloud
# Deploy a managed shared www pool (true/false)
php_fpm_create_www: true

#########################
# 6. MARIADB ROLE       #
#########################

mariadb_version: "11.4"  # MariaDB version

# Database user configuration
db_remote_user: "lucian"  # Remote database user with full privileges
db_webclient_password: "{{ vault_db_webclient_password }}"
db_remote_password: "{{ vault_db_remote_password }}"

# Database settings
db_backup_dir: "/var/backups/mysql"
setup_db_backups: true
db_optimize_for_server: true
db_bind_address: "0.0.0.0"  # Listen on all interfaces (change to 127.0.0.1 for localhost only)
db_port: 3306
db_character_set: "utf8mb4"
db_collation: "utf8mb4_unicode_ci"

#########################
# 7. MAIL ROLE          #
#########################

install_mail: true  # Install mail server (Postfix + Dovecot)

# Email domain settings
mail_subdomain: "mail.{{ domain }}"
mail_admin_email: "admin@{{ domain }}"

# Webmail settings
webmail_path: "/home/{{ master_domain }}/roundcube"
webmail_version: "1.6.11"

# Database settings for mail services
mail_db_name: "mailserver"  # Store mail accounts, domains, and delivery information
mail_db_user: "mailuser"
mail_db_password: "{{ vault_mail_db_password }}"  # Reference to vault variable

# Mail service ports
mail_service_ports:
  - { proto: tcp, port: 25 }    # SMTP
  - { proto: tcp, port: 587 }   # Submission
  - { proto: tcp, port: 465 }   # SMTPS
  - { proto: tcp, port: 993 }   # IMAPS
  - { proto: tcp, port: 995 }   # POP3S

# Roundcube database settings
roundcube_db_name: "roundcube"  # Roundcube webmail application database
roundcube_db_user: "roundcube"
roundcube_db_password: "{{ vault_roundcube_db_password }}"  # Reference to vault variable

#########################
# 8. PYTHON ROLE        #
#########################

# Python configuration handled by role defaults

#########################
# 9. GOPROXY ROLE       #
#########################

install_goproxy: true  # Install GoProxy + Tor

#########################
# 10. DEVELOPMENT ROLE  #
#########################

install_development_tools: false  # Install development tools (disabled by default)

#########################
# 11. SECURITY ROLE     #
#########################

# Firewall configuration
firewall_use_ipv6: false  # Enable IPv6 firewall rules
firewall_initialize: true  # Initialize firewall on first run
firewall_allowed_services:
  - { proto: tcp, port: 80 }    # HTTP
  - { proto: tcp, port: 443 }   # HTTPS

# Fail2Ban configuration
fail2ban_enabled: true  # Enable fail2ban intrusion prevention
fail2ban_services:
  - sshd
  - postfix
  - dovecot
fail2ban_socket_timeout: 30  # Socket timeout in seconds

# IP whitelist (IPs that bypass fail2ban - space-separated CIDR notation)
allowed_ips: ""  # Add your trusted IPs here (e.g., "1.2.3.4/32 5.6.7.8/32")
