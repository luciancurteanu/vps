---
- name: Converge
  hosts: all
  become: true
  vars:
    domain: vps.test
    master_domain: vps.test
    mail_db_password: mailpass
    roundcube_db_password: roundcubepass
    db_root_user: root
    db_root_password: ''
    mail_enable_opendkim: false
    mail_enable_roundcube: false
    mail_enable_nginx: false
  pre_tasks:
    - name: Install Molecule prerequisites (DB and helpers)
      ansible.builtin.dnf:
        name:
          - mariadb-server
          - python3-PyMySQL
          - nginx
        state: present
        update_cache: yes

    - name: Ensure MariaDB service is started
      ansible.builtin.systemd:
        name: mariadb
        state: started
        enabled: yes

  roles:
    - role: mail
