[{{ domain }}]
# Run pools under a sanitized unix user (dots replaced by underscores)
# This prevents invalid usernames like 'example.com' and matches created system users
user = {{ domain | replace('.', '_') }}
group = {{ domain | replace('.', '_') }}
listen = {{ php_fpm_listen | default('/var/run/php-fpm/php-fpm.sock') | dirname }}/{{ domain | replace('.', '_') }}.sock
listen.backlog = -1
listen.owner = {{ nginx_user }}
listen.group = {{ nginx_group }}
listen.mode = 0660
pm = dynamic
pm.max_children = 100
pm.start_servers = 20
pm.min_spare_servers = 10
pm.max_spare_servers = 30
pm.max_requests = 1000

php_admin_value[sendmail_path] = /usr/local/postfix/bin/sendmail -t -i
php_admin_value[disable_functions] = passthru,system
php_admin_flag[display_errors] = off
php_admin_flag[log_errors] = on
php_admin_flag[allow_url_fopen] = off
php_admin_flag[allow_url_include] = off
php_admin_flag[file_uploads] = on
php_admin_flag[session.cookie_httponly] = on
php_admin_flag[session.use_cookies] = on
php_admin_flag[session.cookie_secure] = off
php_admin_value[session.name] = SID
php_admin_value[session.cookie_lifetime] = 604800
php_admin_value[session.gc_maxlifetime] = 604800
php_admin_value[session.gc_divisor] = 100
php_admin_value[session.gc_probability] = 1
{# Use /home per-domain paths (domain name kept intact) while pools run as sanitized users #}
php_admin_value[session.save_path] = /home/{{ domain }}/tmp
php_admin_value[sys_temp_dir] = /home/{{ domain }}/tmp
php_admin_value[upload_tmp_dir] = /home/{{ domain }}/tmp
php_admin_value[open_basedir] = /home/{{ domain }}
php_admin_value[cgi.fix_pathinfo] = 0
php_admin_value[memory_limit] = 1024M
php_admin_value[post_max_size] = 512M
php_admin_value[upload_max_filesize] = 512M
php_admin_value[mail.log] = /home/{{ domain }}/logs/php_mail.log
php_admin_value[error_log] = /home/{{ domain }}/logs/php_error.log

php_admin_value[opcache.enable] = 1
php_admin_value[opcache.memory_consumption] = 256
php_admin_value[opcache.interned_strings_buffer] = 16
php_admin_value[opcache.max_accelerated_files] = 10000
php_admin_value[opcache.revalidate_freq] = 2
php_admin_value[opcache.fast_shutdown] = 1
php_admin_value[opcache.enable_cli] = 1
