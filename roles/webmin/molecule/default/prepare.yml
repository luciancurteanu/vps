---
- name: Prepare container for Webmin testing
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Ensure Python 3.9, pip, and dnf-utils are installed (AlmaLinux 9)
      ansible.builtin.dnf:
        name:
          - python3
          - python3-pip
          - dnf-utils
          - procps-ng  # For pgrep command in verify
        state: present
        update_cache: yes
        use_backend: dnf4

    - name: Install Ansible via pip (AlmaLinux 9)
      ansible.builtin.pip:
        name: ansible
        executable: pip3

    - name: Install passlib for crypt support (AlmaLinux 9)
      ansible.builtin.pip:
        name: passlib
        executable: pip3

    - name: Add Docker CE repository (AlmaLinux 9)
      ansible.builtin.command: dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
      args:
        creates: /etc/yum.repos.d/docker-ce.repo

    - name: Install Docker CE CLI (AlmaLinux 9)
      ansible.builtin.dnf:
        name: docker-ce-cli
        state: present
        use_backend: dnf4
